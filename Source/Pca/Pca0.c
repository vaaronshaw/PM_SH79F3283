#include "api_ext.h"
#include"cpu.h"
#if (CPU_TYPE==CPU_SH79F3283)
#include "SH79F3283.h"
#elif (CPU_TYPE==CPU_SH79F328)
#include "SH79F328.h"
#else
#include "SH79F328.h"
#endif
#include"pca_define.h"
#include"intrins.h"
#ifdef MODE0		  //边沿触发捕捉模式
/*****************************************************************************************************
 *  Function Name: init_Pca0cpm0
 *  Created By:    Cathy.Feng
 *  Created Date:  2016-07-19
 *  Input:         None
 *  Output:        None
 *  Description:   配置PCA0的比较/捕捉模块0工作在任意沿捕捉方式
 *  Modified By:   
 *  Modified Date:
 *  History:
 *  Others:                        
 *****************************************************************************************************/ 
void init_Pca0cpm0()
{

/********************************************************************************************************************
P0CMD：
1.配置PCA0工作在单延模式
2.禁止PCA0溢出中断
3.选择系统时钟作为PCA0的时钟源
*********************************************************************************************************************/
	P0CMD=0x0;
/********************************************************************************************************************
P0CPM0（配置比较/捕捉模块0工作方式）:
1.捕捉方式
2.任意沿触发
3.打开捕捉/比较中断
4.使能比较/捕捉模块0
*********************************************************************************************************************/
	P0CPM0=0x39;
/********************************************************************************************************************
P0TOPL，P0TOPH：
配置PCA0计数器最大值
*********************************************************************************************************************/
	P0TOPH=0x08;
	P0TOPL=0x00;
/********************************************************************************************************************
PCACON：
启动PCA0计数器
*********************************************************************************************************************/
	PCACON=0x1;
}
#endif	

#ifdef MODE1				//软件定时方式
/*****************************************************************************************************
 *  Function Name: init_Pca0cpm0
 *  Created By:    Cathy.Feng
 *  Created Date:  2016-07-19
 *  Input:         None
 *  Output:        None
 *  Description:   配置PCA0的比较/捕捉模块0工作在连续定时器方式
 *  Modified By:   
 *  Modified Date:
 *  History:
 *  Others:                        
 *****************************************************************************************************/ 
void init_Pca0cpm0()
{
/********************************************************************************************************************
P0CMD：
1.配置PCA0工作在单延模式
2.禁止PCA0溢出中断
3.选择系统时钟作为PCA0的时钟源
*********************************************************************************************************************/
	P0CMD=0x0;
/********************************************************************************************************************
P0CPM0（配置比较/捕捉模块0工作方式）:
1.连续软件定时方式
2.允许P0CEX0输出波形
3.打开捕捉/比较中断
*********************************************************************************************************************/
	P0CPM0=0x47;
/********************************************************************************************************************
P0TOPL，P0TOPH：
配置PCA0计数器最大值
*********************************************************************************************************************/
	P0TOPH=0x40;
	P0TOPL=0x20;
/********************************************************************************************************************
P0CPH0，P0CPL0：
配置比较/捕捉模块匹配值
*********************************************************************************************************************/
	P0CPH0=0x00;
	P0CPL0=0x20;

/********************************************************************************************************************
使能比较/捕捉模块
启动PCA0计数器
*********************************************************************************************************************/	
	P0CPM0|=0x08;
	PCACON=0x1;
}
#endif	
#ifdef MODE2				 //频率输出方式
/*****************************************************************************************************
 *  Function Name: init_Pca0cpm0
 *  Created By:    Cathy.Feng
 *  Created Date:  2016-07-19
 *  Input:         None
 *  Output:        None
 *  Description:   配置PCA0的比较/捕捉模块0工作在频率输出方式
                   FPxCEXn= FPCAx /(2 × PxCPHn)
 *  Modified By:   
 *  Modified Date:
 *  History:
 *  Others:                        
 *****************************************************************************************************/ 
void init_Pca0cpm0()
{
	IEN2 |=0x20;	  //允许PCA0中断
/********************************************************************************************************************
P0CMD：
1.配置PCA0工作在单延模式
2.允许PCA0溢出中断
3.选择系统时钟作为PCA0的时钟源
*********************************************************************************************************************/
	P0CMD=0x80;
/********************************************************************************************************************
P0CPM0（配置比较/捕捉模块0工作方式）:
1.频率输出方式
*********************************************************************************************************************/
	P0CPM0=0x80;
/********************************************************************************************************************
P0CPH0，P0CPL0：
配置比较/捕捉模块匹配值
*********************************************************************************************************************/
	P0CPH0=0x10;
	P0CPL0=0x20;

/********************************************************************************************************************
使能比较/捕捉模块
启动PCA0计数器
*********************************************************************************************************************/	

	PCACON=0x1;
	P0CPM0|=0x08;
}
#endif
#ifdef MODE3_PWM8				 //8位脉宽调制
/*****************************************************************************************************
 *  Function Name: init_Pca0cpm0（）
 *  Created By:    Cathy.Feng
 *  Created Date:  2016-07-19
 *  Input:         None
 *  Output:        None
 *  Description:   配置PCA0的比较/捕捉模块0工作在PWM8方式, 输出占空比为0.8的波形，duty为低电平有效
				   配置PCA0的比较/捕捉模块1工作在PWM8方式, 输出占空比为0.8的波形，duty为高电平有效
                   Duty=（256-（PxCPHn+1））/256
 *  Modified By:   
 *  Modified Date:
 *  History:
 *  Others:                        
 *****************************************************************************************************/ 
void init_Pca0cpm0()
{
	IEN2 |=0x20;	  //允许PCA0中断
/********************************************************************************************************************
P0CMD：
1.配置PCA0工作在单延模式
2.允许PCA0溢出中断
3.选择系统时钟作为PCA0的时钟源
*********************************************************************************************************************/
	P0CMD=0x80;
/********************************************************************************************************************
P0CPM0（配置比较/捕捉模块0工作方式）:
1.PWM8输出方式
2.打开捕捉/比较中断
*********************************************************************************************************************/
	P0CPM0=0xC3;
/********************************************************************************************************************
P0CPH0，P0CPL0：
配置比较/捕捉模块0匹配值
*********************************************************************************************************************/
	P0CPH0=0x30;
	P0CPL0=0x30;
/********************************************************************************************************************
使能比较/捕捉模块0
PWM正向输出波形
*********************************************************************************************************************/	
	P0CPM0|=0x08;


/********************************************************************************************************************
P0CPM1（配置比较/捕捉模块1工作方式）:
1.PWM输出方式
2.打开捕捉/比较中断
*********************************************************************************************************************/
	P0CPM1=0xC3;
/********************************************************************************************************************
P0CPH1，P0CPL1：
配置比较/捕捉模块1匹配值
*********************************************************************************************************************/
	P0CPH1=0x30;
	P0CPL1=0x30;
/********************************************************************************************************************
使能比较/捕捉模块1
PWM反向输出波形
*********************************************************************************************************************/	
	P0CPM1|=0x0c;
/********************************************************************************************************************
启动PCA0计数
*********************************************************************************************************************/	

	PCACON=0x1;


}
#endif					
#ifdef MODE3_PWM16			   //16位脉宽调制
/*****************************************************************************************************
 *  Function Name: init_Pca0cpm0（）
 *  Created By:    Cathy.Feng
 *  Created Date:  2016-07-19
 *  Input:         None
 *  Output:        None
 *  Description:   配置PCA0的比较/捕捉模块0工作在PWM16方式, 输出占空比为0.8的波形，duty为低电平有效
				   配置PCA0的比较/捕捉模块1工作在PWM16方式, 输出占空比为0.8的波形，duty为高电平有效
                   Duty=（65536-（PxCPn+1））/65536
 *  Modified By:   
 *  Modified Date:
 *  History:
 *  Others:                        
 *****************************************************************************************************/ 
void init_Pca0cpm0()
{
	IEN2 |=0x20;	  //允许PCA0中断
/********************************************************************************************************************
P0CMD：
1.配置PCA0工作在单延模式
2.允许PCA0溢出中断
3.选择系统时钟作为PCA0的时钟源
*********************************************************************************************************************/
	P0CMD=0x80;
/********************************************************************************************************************
P0CPM0（配置比较/捕捉模块0工作方式）:
1.PWM16输出方式
2.打开捕捉/比较中断
*********************************************************************************************************************/
	P0CPM0=0xD3;
/********************************************************************************************************************
P0CPH0，P0CPL0：
配置比较/捕捉模块0匹配值
*********************************************************************************************************************/
	P0CPH0=0x30;
	P0CPL0=0x30;
/********************************************************************************************************************
使能比较/捕捉模块0
PWM正向输出波形
*********************************************************************************************************************/	
	P0CPM0|=0x08;


/********************************************************************************************************************
P0CPM1（配置比较/捕捉模块1工作方式）:
1.PWM输出方式
2.打开捕捉/比较中断
*********************************************************************************************************************/
	P0CPM1=0xD3;
/********************************************************************************************************************
P0CPH1，P0CPL1：
配置比较/捕捉模块1匹配值
*********************************************************************************************************************/
	P0CPH1=0x30;
	P0CPL1=0x30;
/********************************************************************************************************************
使能比较/捕捉模块1
PWM反向输出波形
*********************************************************************************************************************/	
	P0CPM1|=0x0c;
/********************************************************************************************************************
启动PCA0计数
*********************************************************************************************************************/	

	PCACON=0x1;


}

#endif
#ifdef MODE3_XPWM16			  //16位相位修正脉宽调制
/*****************************************************************************************************
 *  Function Name: init_Pca0cpm0（）
 *  Created By:    Cathy.Feng
 *  Created Date:  2016-07-19
 *  Input:         None
 *  Output:        None
 *  Description:   配置PCA0的比较/捕捉模块0工作在XPWM16方式, 输出频率为250Hz的正向波形
				   配置PCA0的比较/捕捉模块1工作在XPWM16方式,  输出频率为250Hz的反向波形
                   F=fsys/(2*PxTOP)
 *  Modified By:   
 *  Modified Date:
 *  History:
 *  Others:                        
 *****************************************************************************************************/ 
void init_Pca0cpm0()
{
	IEN2 |=0x20;	  //允许PCA0中断
/********************************************************************************************************************
P0CMD：
1.配置PCA0工作在双延模式
2.允许PCA0溢出中断
3.选择系统时钟作为PCA0的时钟源
*********************************************************************************************************************/
	P0CMD=0xC0;
/********************************************************************************************************************
P0TOPH，P0TOPL：
配置PCA0计数最大值
*********************************************************************************************************************/
	P0TOPH=0x01;
	P0TOPL=0x00;
/********************************************************************************************************************
P0CPM0（配置比较/捕捉模块0工作方式）:
1.16位相位修正PWM输出方式
2.打开捕捉/比较中断
*********************************************************************************************************************/
	P0CPM0=0xE3;
/********************************************************************************************************************
P0CPH0，P0CPL0：
配置比较/捕捉模块0匹配值
*********************************************************************************************************************/
	P0CPH0=0x0;
	P0CPL0=0x90;
/********************************************************************************************************************
使能比较/捕捉模块0
PWM正向输出波形
*********************************************************************************************************************/	
	P0CPM0|=0x08;


/********************************************************************************************************************
P0CPM1（配置比较/捕捉模块1工作方式）:
1.PWM输出方式
2.打开捕捉/比较中断
*********************************************************************************************************************/
	P0CPM1=0xE3;
/********************************************************************************************************************
P0CPH1，P0CPL1：
配置比较/捕捉模块1匹配值
*********************************************************************************************************************/
	P0CPH1=0x0;
	P0CPL1=0x90;

/********************************************************************************************************************
使能比较/捕捉模块1
PWM反向输出波形
*********************************************************************************************************************/	
	P0CPM1|=0x0c;
/********************************************************************************************************************
启动PCA0计数
*********************************************************************************************************************/	

	PCACON=0x1;


}
#endif


#ifdef MODE3_XPPWM16		   //16位相频修正脉宽调制

/*****************************************************************************************************
 *  Function Name: init_Pca0cpm0（）
 *  Created By:    Cathy.Feng
 *  Created Date:  2016-07-19
 *  Input:         None
 *  Output:        None
 *  Description:   配置PCA0的比较/捕捉模块0工作在XPPWM16方式, 输出频率为250Hz的正向波形
				   配置PCA0的比较/捕捉模块1工作在XPPWM16方式,  输出频率为250Hz的反向波形
                   F=fsys/(2*PxTOP)
 *  Modified By:   
 *  Modified Date:
 *  History:
 *  Others:                        
 *****************************************************************************************************/ 
void init_Pca0cpm0()
{
	IEN2 |=0x20;	  //允许PCA0中断
/********************************************************************************************************************
P0CMD：
1.配置PCA0工作在双延模式
2.允许PCA0溢出中断
3.选择系统时钟作为PCA0的时钟源
*********************************************************************************************************************/
	P0CMD=0xC0;
/********************************************************************************************************************
P0TOPH，P0TOPL：
配置PCA0计数最大值
*********************************************************************************************************************/
	P0TOPH=0x01;
	P0TOPL=0x00;
/********************************************************************************************************************
P0CPM0（配置比较/捕捉模块0工作方式）:
1.16位相频修正PWM输出方式
2.打开捕捉/比较中断
*********************************************************************************************************************/
	P0CPM0=0xF3;
/********************************************************************************************************************
P0CPH0，P0CPL0：
配置比较/捕捉模块0匹配值
*********************************************************************************************************************/
	P0CPH0=0x0;
	P0CPL0=0x90;
/********************************************************************************************************************
使能比较/捕捉模块0
PWM正向输出波形
*********************************************************************************************************************/	
	P0CPM0|=0x08;


/********************************************************************************************************************
P0CPM1（配置比较/捕捉模块1工作方式）:
1.PWM输出方式
2.打开捕捉/比较中断
*********************************************************************************************************************/
	P0CPM1=0xF3;
/********************************************************************************************************************
P0CPH1，P0CPL1：
配置比较/捕捉模块1匹配值
*********************************************************************************************************************/
	P0CPH1=0x0;
	P0CPL1=0x90;

/********************************************************************************************************************
使能比较/捕捉模块1
PWM反向输出波形
*********************************************************************************************************************/	
	P0CPM1|=0x0c;
/********************************************************************************************************************
启动PCA0计数
*********************************************************************************************************************/	

	PCACON=0x1;

}






#endif
					  